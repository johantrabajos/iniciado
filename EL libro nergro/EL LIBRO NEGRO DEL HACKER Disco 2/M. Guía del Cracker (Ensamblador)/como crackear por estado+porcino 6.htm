<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0044)http://users.vr9.com/wktrelz/tktk/eporc6.htm -->
<html>

<head>
<title>WKT -- COMO CRACKEAR POR ESTADO+PORCINO --</title>
<meta content="text/html; charset=windows-1252" http-equiv="Content-Type">

<meta content="Microsoft FrontPage 3.0" name="GENERATOR">
</head>

<body aLink="#efff2f" bgColor="#000000" link="#c00061" text="#ffffff" vLink="#00670e">

<p align="center"><br>
</p>
<div align="center"><center>

<table border="2">
<TBODY>
  <tr>
    <td align="middle" bgColor="#ffcc33" vAlign="center"><b><font color="#ffffff" face="Arial"
    size="+2">COMO CRACKEAR POR ESTADO+PORCINO</font> </b></td>
  </tr>
</TBODY>
</table>
</center></div>

<p align="center"><br>
<br>
</p>
<div align="center"><center>

<table border="2">
<TBODY>
  <tr>
    <td align="middle" bgColor="#000000" vAlign="center"><font color="#ffcc33" face="Arial"
    size="+2">CAPÍTULO VI. DESVIRGANDO EXPEDIENTES X</font><br>
    <font color="#ffcc33" size="+1"><u>-Como Crackear Contaplus Élite Pyme- </u></font></td>
  </tr>
</TBODY>
</table>
</center></div>

<p><br>
</p>

<p align="center"><font color="#ffcc33" size="+1"><u>Junio 1999</u></font><br>
<br>
</p>
<div align="center"><center>

<table border="0">
<TBODY>
  <tr>
    <td align="middle" bgColor="#ffcc33" vAlign="center"><font color="#000000" size="+2"><b>Indice</b></font>
    </td>
  </tr>
  <tr>
    <td align="left" vAlign="center"><font color="#ffcc33" face="Arial" size="3"><u><b>INTRODUCCIÓN</b></u></font>
    <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>AL ATAQUEEEEEEE</b></u></font> <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>PROTECCIONES ESPAÑOLAS</b></u></font> <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>PRIMERA APROXIMACION Y PRIMER ENFADO</b></u></font>
    <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>OBJETIVOS</b></u></font> <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>SEGUNDA APROXIMACIÓN Y SEGUNDA OSTIA.
    LAS COSAS SE COMPLICAN</b></u></font> <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>LA SOLUCIÓN A LA PELUA CUESTIÓN</b></u></font>
    <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>MODIFICACIÓN DE FICHEROS CREADOS EN
    TIEMPO DE EJECUCIÓN</b></u></font> <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>INTENTO SER UN TIO ELEGANTE, PERO NO
    ESTÚPIDO</b></u></font> <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>CAER EN LA CUENTA</b></u></font> <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>OPCION 3 CAÑERA</b></u></font> <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>VUELTA A LA PROTECCIÓN</b></u></font> <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>ESTÚPIDO VELO</b></u></font> <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>¿ÉXITO?</b></u></font> <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>SOLUCIONES VIABLES</b></u></font> <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>HORROR Y ESPANTO</b></u></font> <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>EL MISTERIO INSONDABLE</b></u></font> <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>EL EXPEDIENTE X DESVIRGADO</b></u></font>
    <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>JUGUETEANDO</b></u></font> <br>
    <br>
    <font color="#ffcc33" face="Arial" size="3"><u><b>PD PARA EL PROGRAMADOR</b></u></font> <br>
    <br>
    </td>
  </tr>
</TBODY>
</table>
</center></div>

<p align="center"><br>
<br>
</p>
<div align="center"><center>

<table bgColor="#000000" border="4" width="80%">
<TBODY>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00">INTRODUCCIÓN</font></b> <p><b>Victima:
    CONTAPLUS ÉLITE PYME<br>
    Site: www.gruposp.com<br>
    HERRAMIENTAS:<br>
    <br>
    Desensamblador. Por ejemplo w32dasm<br>
    Editor hexadecimal. Por ejemplo uedit<br>
    Paciencia y Confianza. <br>
    <br>
    Saludos familia. Aprovecho los ratos para escribir algunas cosillas.<br>
    En esta ocasión acometemos uns joyita con Discos llave,Números de serie,encriptación,
    descompresión en tiempo de ejecución y misterios insondables. <br>
    Un dulce para pasar el rato. </b></p>
    <p><b>Llegó a mis manos una petición de crack. Normalmente la desestimo, a menos que la
    pida un amigo, me interese o favorezca mi entorno de trabajo. <br>
    Es mejor enseñar a crakear que enseñar a llorar para suplicar. <br>
    En fin, toda esa filosofía expuesta por +ORC y reescrita por E+P. Son las 8:00 de la
    mañana y me he pasado toda la noche crakeando. <br>
    Si señor, hay pocos placeres comparables. <br>
    Los crackers me entenderán perfectamente de lo que les hablo:-). <br>
    El peluo maulla desesperao y la gorda duerme a mi lado.<br>
    A veces la vida te sonríe y no sabes porqué.Aprovéchala antes de que cambie. <br>
    <br>
    En este entorno , nada se puede resistir... </b></td>
    <td>&nbsp;</td>
  </tr>
</TBODY>
</table>
</center></div>

<p align="center"><br>
<br>
</p>
<div align="center"><center>

<table bgColor="#000000" border="4" width="80%">
<TBODY>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00">AL ATAQUEEEEEEE</font> </b><p><b>Miremos
    nuestro producto. Se trata de un clásico de la facturación española. Contaplus Pyme
    Élite Otoño 98 del 1-11-98<br>
    Un paquete en formato CD que se compone de:<br>
    <br>
    ContaPlus<br>
    FacturaPlus<br>
    NominaPlus<br>
    PersonalPlus<br>
    Utilidades (Antivirus Norton, Antivirus Mcafee, Sidekick y PC Anywhere) <br>
    <br>
    La web la tenemos en www.gruposp.com.<br>
    Despendolemos un ratico por su web a ver a cuanto tienen el timo.<br>
    <br>
    Uhmm 2 millones de ventas y nuestro producto 165.000 pelas, !!! <br>
    Precio especial !!!! <br>
    Joer, pos si que, pa una urgencia, vamos.<br>
    Se merecen que lo crackeen, si señor.<br>
    </b></td>
    <td>&nbsp;</td>
  </tr>
</TBODY>
</table>
</center></div>

<p align="center"><br>
<br>
</p>
<div align="center"><center>

<table bgColor="#000000" border="4" width="80%">
<TBODY>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00">PROTECCIONES ESPAÑOLAS </font></b><p><b>A
    primera vista, el programa es español y por tanto la protección también. Conociendo los
    antecedentes de protecciones españolas, estimo que estará roto en 5 minutos. Sólo
    recuerdo una protección española cojonuda. Era de un catalán y se la había puesto a su
    programa de rompecabezas. Si sería buena que fue uno de los &quot;coladores&quot;para la
    +HCU con +ORC y +Fravia(a ver si se recupera pronto, leñe) </b></td>
  </tr>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00">PRIMERA APROXIMACION Y PRIMER
    ENFADO</font></b><p><b>Empezamos mal, intentamos instalar el contaplus y nos pide un
    disquete llave. Joder, ¿no habían pasado al olvido esas protecciones basadas en discos
    llave?. ¿Es que no aprenden?. Los discos llave fueron desechados porque <br>
    no eran fiables, se podían cascar en el trayecto de la fábrica al usuario y luego vete a
    reclamar al maestro armero una vez que has pagado el producto, eso sin contar <br>
    el tiempo de espera del nuevo disquete, y que el que te manden no esté roto. <br>
    Para colmo, estos discos se formatean a medida por lo que no se pueden <br>
    copiar (en general) ni siquiera para sacar una triste copia de seguridad. <br>
    Como veis, una mierda, y los del CONTAPUS dale que dale. </b></td>
  </tr>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00"><font color="#00ff00">OBJETIVOS</font>
    </font></b><p><b>Estan claros, cepillarse al CONTAPLUS y obviar el disco llave.<br>
    Pero conseguiremos bastantes cositas más. </b></td>
  </tr>
</TBODY>
</table>
</center></div>

<p align="center"><br>
<br>
</p>
<div align="center"><center>

<table bgColor="#000000" border="4" width="80%">
<TBODY>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00">SEGUNDA APROXIMACIÓN Y SEGUNDA
    OSTIA. LAS COSAS SE COMPLICAN</font></b><p><b>Si intentamos instalar sin disco llave nos
    aparece una estúpida ventana: <br>
    &quot;Inserte disco llave, Por favor retire el disco actual y bla,bla,bla&quot; <br>
    La ventanita tiene pinta de dialogbox, así que nos vamos al SoftIce y ponemos <br>
    unas bonitas trampas para osos. <br>
    <br>
    bpx dialogbox<br>
    bpx dialogboxparama<br>
    <br>
    Lanzamos al niño y el que pica es el bpx dialogboxparama.<br>
    Con f12 aparece la ventana de error, pulsamos NO y caemos en kernel!alloc. <br>
    Ostias que feo. F12 antes pa asomar el pescuezo en <br>
    :10012739 dentro del proceso ~GLC000x. (la x es variable). <br>
    <br>
    Ostias, que mierda es esta, ¿dónde está es fichero ese tan raro?.<br>
    En el directorio del conta no, seguro.<br>
    ¿Pero entonces dónde?. Si buscamos el ficherito no está en el disco duro. <br>
    Entonces, ¡por la madre de MITRA!, ¿que coño pasa?. <br>
    Pensad una posible solución antes de pasar al siguiente párrafo, que os van a salir
    almorranas cerebrales. </b></td>
  </tr>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00">LA SOLUCIÓN A LA PELUA CUESTIÓN</font></b><p><b>Pos
    si, seguro que ya lo habeis acertado :-)<br>
    El puto fichero se crea en tiempo de ejecución y se borra antes salir. <br>
    Por eso no aparece en el directorio de instalación ni en el disco duro al finalizar. <br>
    Pero entonces, segunda e importante cuestión:<br>
    ¿como mangonearemos si se genera en tiempo de ejecución? <br>
    Es vital poder toquetear para saltarse la protección.<br>
    Así pues, relegamos el estudio del<br>
    para centrarnos en como se puede modificar un fichero que se crea en tiempo de ejecución.
    </b></td>
  </tr>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00"><font color="#00ff00">MODIFICACIÓN
    DE FICHEROS CREADOS EN TIEMPO DE EJECUCIÓN</font> </font></b><p><b>Las variantes que se
    me ocuren de menos a más elegantes son: <br>
    <br>
    1 Entender como se crea el fichero y retocarlo antes de que se cree. <br>
    2 Parchearlo en memoria una vez creado<br>
    - mediante un parche en tiempo de ejecución.<br>
    - Aplicando ingeniería inversa para localizar y redirigir un trozo de código <br>
    inútil dentro del ejecutable y que parchee el fichero.<br>
    3 Dejar que se cree en memoria pero redirigirlo a un fichero en disco ya retocado. <br>
    <br>
    Recuerdo cierta protección del mismo tipo en el Hotmetal 4.0. antes que los encerraran en
    la inutilidad del vbox. </b></td>
  </tr>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00"><font color="#00ff00">INTENTO SER
    UN TIO ELEGANTE, PERO NO ESTÚPIDO</font> </font></b><p><b>Pues eso, intento ser un tio
    elegante y opto por la primera opción y descubro lo siguiente: <br>
    <br>
    * Dentro del fichero instalar.exe del contaplus reside el famoso ~GLC000x. <br>
    En tiempo de ejecución se lee un trozo del fichero instalar.exe, se marea un poco y se
    construye el nuevo fichero. <br>
    El nombre se construye a partir de una cadena constante :~GLC%04x.tmp. <br>
    Podeis abrir el fichero instalar.exe y cambiar el nombre por algo más decente. <br>
    Tengo destripado y pasado a C el algoritmo que extrae del fichero instalar.exe los bytes,
    los marea un poco y los escribe en el ~GLC%04x.tmp. <br>
    Si quereis más datos del algoritmo mandadme un mail. <br>
    <br>
    * Me quedaba la duda de si el autor de la protección había encriptado, comprimido o
    encriptado/comprimido. <br>
    La respuesta es sólo comprimido siguiendo un complicado algoritmo que tengo casi
    analizado. <br>
    Asi pues sólo queda otra semana para crear un compresor (el descompresor ya lo tengo,
    está en el propio programa). <br>
    <br>
    * Como la cosa se complicaba, deseche esta vía y me fui a la opción 2. <br>
    Pronto la desistimé porque no sabía cuantos parches tenía que aplicar. <br>
    <br>
    Así pués, me fui a la vía 3. Ya sé, ya sé, es la más cutre, pero rula :-) </b></td>
  </tr>
</TBODY>
</table>
</center></div>

<p align="center"><br>
<br>
</p>
<div align="center"><center>

<table bgColor="#000000" border="4" width="80%">
<TBODY>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00"><font color="#00ff00">CAER EN LA
    CUENTA</font> </font></b><p><b>Concurrida audiencia, por si no os habeis dado cuenta, la
    protección es muy buena. <br>
    RESPETAD AL PROGRAMADOR que se ha entretenido en comprimir sus datos <br>
    y descomprimirlos en tiempo de ejecución. <br>
    Buen trabajo BBYYMMAARRCCOOSS. <br>
    Quizás no esté todo perdido dentro del panorama de programadores españoles. <br>
    Aupa muchachos!!! </b></td>
  </tr>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00"><font color="#00ff00">OPCION 3
    CAÑERA</font> </font></b><p><b>Lo primero es pillar una copia chachi del ~GLC%04x.tmp pa
    poder <br>
    modificarla tranquilamente y después regirigir el programa para que cargue nuestra dll y
    no la que ha creado. <br>
    Para ello, lanzamos el instalar y aparece la venta de error con &quot;si&quot; y
    &quot;no&quot; . <br>
    Nos vamos al explorador de Windows con la teclilla nueva con el logo del windoze <br>
    (ostias, pero si sirve pa algo y to), o bien lo abrimos antes que el instalar y conmutamos
    con ALT+TAB. <br>
    Estamos seguros que el fichero debe de existir porque aún no ha acabado el programa (nos
    da la opción de continuar si pusamos &quot;si&quot;). <br>
    Buscamos en el explorador los ficheros que empiezen por ~GLC y bingo, <br>
    lo tenemos en c:\windows. Con mucho cuidado lo copiamos y lo pegamos en un sitio seguro. <br>
    Nuestra cena ya está en la red :-=). <br>
    Para los descuidados como yo, habilitarle la opción de sólo lectura con el botón
    derecho <br>
    del ratón y propiedades. Sino lo perderemos cuando lo utilizemos. <br>
    Recordad quitarle lo de sólo lectura para parchearlo. <br>
    <br>
    Do quiera que un fichero se cargue en memoria y se ejecute en tiempo de ejecución este
    debe ser una dll. <br>
    Ya sé, ya sé, no tiene extendión dll ni ná, pero no es necesario. <br>
    Para que un fichero sea considerado dll basta con tener nombre y extensión, y la
    constante ~GLC%04x.tmp lo cumple. <br>
    Por tanto, instalar debe cargarlo como librería. Si lo desensamblamos, vemos que usa la
    función del api KERNEL32.LoadLibraryA y además sólo una vez. <br>
    <font size="2"></p>
    <pre>:004024F7 740A                    je 00402503
:004024F9 E87E060000              call 00402B7C
:004024FE E9BD000000              jmp 004025C0

* Referenced by a (U)nconditional or (C)onditional Jump at Address:
|:004024F7(C)
|
:00402503 8D85E8FEFFFF            lea eax, dword ptr [ebp+FFFFFEE8]
:00402509 50                      push eax; Nombre churro de la librería ~GLC%04x.tmp

* Reference To: KERNEL32.LoadLibraryA, Ord:0190h
                                  |
:0040250A FF1534304000            Call dword ptr [00403034]
</font>
Ahora hay que aplicar un poco de ingeniería inversa para        transformar y que cargue siempre nuestra librería retocada. Os ahorro el        proceso mental y obtenemos después de verificar que nunca se pasa por        
:004024F9 (con un bpx por ejemplo) 

<font
size="2"></pre>
    <pre>:004024F7 8D85E8FEFFFF lea eax, dword ptr [ebp+FFFFFEE8];Dirección del nombre de la dll a cargar
:004024FD C700432E6100 mov dword ptr [eax], 00612E43    ;Constante .a0 y aprovechamos la c inicial
                                                         de [eax] nos queda c.a
:00402503 8D85E8FEFFFF            lea eax, dword ptr [ebp+FFFFFEE8];Guardamos las modificaciones.
:00402509 50                      push eax

* Reference To: KERNEL32.LoadLibraryA, Ord:0190h
                                  |
:0040250A FF1534304000            Call dword ptr [00403034]

</font>Con esto siempre se carga la librería &quot;c.a&quot;. Así pues        renombramos la ~GLC%04x.tmp que habiamos pescado antes como &quot;c.a&quot; . Ya sé,        el nombre es un poco cutre, pero si no os gusta retocarlo vosotros. No se        os olvide indicar que es de sólo lectura si no lo queréis perder.        

Si repetimos lo del bpx dialogboxparama aparecemos en el proceso        C!text (nuestro fichero c.a). Vamos por el buen camino. To este rollo pa        redirigir un puto fichero, la protección debe ser la ostia. Estoy ansioso        :-) 

Resumiendo, buscamos en el instalar.exe 74 0A E8 7E 06 00 00 y        lo encontramos en 0x18F7 y cambiamos por 8D 85 E8 FE FF FF C7 00 43 2E 61        00 </b></pre>
    </td>
  </tr>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00"><font color="#00ff00">VUELTA A LA
    PROTECCIÓN</font> </font></b><p><b>Ya podemos mangonear tranquilos nuestro C.a. <br>
    Ahora hay que localizar donde se llama al disco llave y neutralizarlo. <br>
    Los accesos al disco se pueden hacer de forma cutre y a alto nivel con
    &quot;deviceiocontrol&quot; <br>
    o bien usando las interrupciones a pelo. Como podeis sospechar, se han usado los
    deviceiocontrol. <br>
    Si en el softIce ponemos un bpx deviceiocontrol aparecemos en una dll mu fea GLfxxxx.tmp. <br>
    Esto suena al mismo truquillo de descompresión en tipo de ejecución. <br>
    Si pusamos unas 20 veces f12 reaparecemos en nuestra querida c.a <br>
    <font size="2"></p>
    <pre>:10015244 FF24858E540110          jmp dword ptr [4*eax+1001548E]
:1001524B FF550C                  call [ebp+0C] ;Llamada a la feisima glfxxxx.tmp
:1001524E E93C010000              jmp 1001538F
:10015253 FF75B4                  push [ebp-4C]
:10015256 FF550C                  call [ebp+0C] ;2º Llamada

</font>
Os ahorro el trabajo y os comento como funciona el        esquema de protección a este nivel. 
Se crean 2 dll en tiempo de        ejecución en el mismo estilo que ya hemos comentado. 
Estas dll se        encargan de todo el acceso al disco llave. 
Los parámetros a las dll se        pasan (agarraos) en cadenas ascii. 
Basta con poner un bpx 1001524B y        echar un vistazo a esi y edi.
Obtendremos parámetros del tipo        
3HayDisco
3Esdisco
3Instalaciones
</b></pre>
    </td>
  </tr>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00"><font color="#00ff00">ESTÚPIDO
    VELO</font> </font></b><p><b>Corramos un estúpido velo en esta parte de la protección,
    porque es la más patética. <br>
    Baste decir dos cosas, para anular completamente al disco hay que parchear :1001524B. <br>
    En :1001524B se comprueba que existe disco, que el disco tiene el formato adecuado, <br>
    se leen el número de licencias . <br>
    Si existe algún error devuelven en eax=0, sino devuelven eax=1 <br>
    Así pues cambiamos <br>
    <font size="2"></p>
    <pre>                     :10015244 FF24858E540110          jmp dword ptr [4*eax+1001548E]
                     :1001524B FF550C                  call [ebp+0C] 
                     :1001524E E93C010000              jmp 1001538F
                     :10015253 FF75B4                  push [ebp-4C]
                     :10015256 FF550C                  call [ebp+0C] ;2º Llamada

Por
                     :1001524B 33 C0                   xor eax,eax 
                     :1001524D 40                      inc eax
                     :1001524E E93C010000              jmp 1001538F
                     :10015253 33 C0                   xor eax,eax
                     :10015255 33 C0                   xor eax,eax
                     :10015257 40                      inc eax
                     :10015257 90                      nop 
				</font>
Buscamos FF 24 85 8E 54 01 10 en c.a y lo encontramos        
en 0x1464B donde ponemos 33 C0 40 E9 3C 01 00 00 33 C0 33 C0 40 90        
Con esto quedan fulminados los accesos a disco. 
Si seguimos        adelante nos pide un número de serie que se puede obviar si parcheamos en        
<font
size="2"></pre>
    <pre>:1001525E FF75B8                  push [ebp-48]
:10015261 FF75B4                  push [ebp-4C]
:10015264 FF550C                  call [ebp+0C]; eax=0 si todo va bien.
:10015267 E923010000              jmp 1001538F


por 


:1001525E 33C0                    xor eax, eax
:10015260 33C0                    xor eax, eax
:10015262 33C0                    xor eax, eax
:10015264 33C0                    xor eax, eax
:10015266 90                      nop
:10015267 E923010000              jmp 1001538F
</font>
Si no parcheamos los push el programa        casca.
Resumiendo, buscamos en c.a ff 75 b8 ff 75 b4 ff 55 0C E9 23 01        00 00 
y lo encontramos en 0x1465E, cambiándolo por 33 c0 33 c0 33 c0        33 c0 90 
Cuando pida el serial podemos introducir cualquier churro        numérico p.e: 111-1-696969-11 
En el nombre de la empresa y nombre del        usuario introducimos más de dos caracteres. 

Curiosamente todas        estas rutinas GLC de acceso a disco y check del serial, aparecen como        
una dll normal spptr.dll en el directorio de instalación. Para qué, mu        sencillo, 
para deinstalar y eliminar una licencia del disco llave.        
En teoría hay un número límite de instalaciones, cada vez que se        instala 
el programa se elimina una licencia del disco llave y cada vez        que se desistala se añade una. 

¿ÉXITO?
Si seguimos todos los        pasos, la instalación finaliza correctamente .
Ávidos lanzamos el        programa y crash.&quot;Aplicación instalada incorrectamente&quot;. 
¿En qué nos        hemos equivocado?. Pensad un poco. </b></pre>
    </td>
  </tr>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00"><font color="#00ff00">SOLUCIONES
    VIABLES</font> </font></b><p><b>Seguro que habéis llegado a la misma conclusión que yo.<br>
    Las rutinas de manejo de disco que hemos inutilizado, dejaban algun flag en algún sitio<br>
    que indicara que el programa estaba bien instalado. <br>
    Así pues hay quedan dos opciones: <br>
    <br>
    1 Saltar la comprobación en el programa principal.<br>
    2 Activar ese flag.<br>
    </b></td>
  </tr>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00"><font color="#00ff00">HORROR Y
    ESPANTO</font> </font></b><p><b>Seleccionando la opción 1 nos encontramos en un avispero.<br>
    El progrma principal está hecho en CLIPPER.<br>
    Qué horror, aún se siguen usando esas herramientas del demonio. <br>
    Si queréis pasarlo realmente mál intendad, trazar un programa en clipper. <br>
    El control se realiza por bucles<br>
    de salto del tipo call[ax+4] que conducen a otros bucles de salto call [ebx+6], hasta el
    inifito. <br>
    Todo está dirigido por tabla y en código de 16bits. <br>
    Osea nada de usar la potencia de los registros de 32 bits.<br>
    Una montaña de mierda, como podreis observar. <br>
    Nada recomendabe ni saludable. <br>
    Optamos por la opción 2. Para eso llamamos a nuestro amigo y le pedimos que nos comprima <br>
    el CONTAPLUS (bien instalado) en <br>
    disquetes para compararlo con el que tenemos. Busque las diferencias. </b></td>
  </tr>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00"><font color="#00ff00">EL MISTERIO
    INSONDABLE</font> </font></b><p><b>Si descomprimimos el CONTAPLUS bien instalado en
    nuestro disco duro nos llevamos <br>
    una desagradable sorpresa. &quot;Aplicación mal instalada&quot;. <br>
    Joder, que coño pasa, pero si lo hemos copiado de uno que estaba bien instalado. <br>
    A ver, a lo mejor accede al registro del sistema buscando algo raro. <br>
    Lanzamos el regmon y vemos que la aplicación accede pero busca cosas nada importantes. <br>
    Podréis pensar, bueno quizás busque un fichero extraño que no hayamos copiado. <br>
    Lanzamos en filemon y sólo accede al win.ini fuera de su directorio. <br>
    Miramos el win.ini y no vemos nada sospechoso. <br>
    <br>
    ¿To esto está mu bien, pero que coño mira para saber que no está bien instalado? <br>
    <br>
    Este es el misterio insondable que me ha tenido la noche en velo y que me ha hecho
    disfrutar <br>
    como un enano cabezón. Pero hay más, si copiamos el directorio de instalación en el
    disco duro <br>
    donde se instaló originalmnte, el programa deja de funcionar. <br>
    Quedan eliminados los flags en el registro del sistema y el acceso a ficheros raros, <br>
    como ya suponíamos. Y el colmo, si copiamos y pegamos el ejecutable en el directorio de <br>
    instalación del disco duro original de instalación el jodio programa funciona con el<br>
    ejecutable original, pero no con la copia. ¿es mágia? <br>
    ¿hay una explicación razonable o estamos ante un expediente X ? <br>
    <br>
    Pensad el problema antes de mirad la solución, es apasionante. <br>
    Centraos en lo extraño que es que funcione con el ejecutable original <br>
    y no con la copia, cuando son los mismos ficheros. </b></td>
  </tr>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00"><font color="#00ff00">EL EXPEDIENTE
    X DESVIRGADO</font> </font></b><p><b>Lo más curioso de todo es que el programa funciona
    con el ejecutable original, pero no con la copia. <br>
    En principio, esto no tiene sentido, a menos, claro está que exista una diferencia entre
    el original y el copiado. Exactamente, la fecha de creación. <br>
    Para comprobarlo retrasé el reloj del windoze hasta la fecha hora y minuto en el que se
    había<br>
    construido el ejecutable original.<br>
    <br>
    En ese preciso momento realizé una copia del origial y BINGO, la copia del ejecutable
    funcionaba. <br>
    Ya hemos encontrado el flag, pero hace falta saber donde se guarda. <br>
    En el registro del sistema no, porque no realiza ninguna operación extraña. <br>
    Puede guardarlo en algún campo de la base de datos , osea en los fichero dbf. Para
    eliminar esta opción copie todos los ficheros <br>
    (excepto el ejecutable) de nuestro CUENTAPLUS al directorio original, y seguia
    funcionando. <br>
    En conclusión, el flag está dentro del propio ejecutable. <br>
    Para comprobarlo, comparé el ejecutable original y el nuestro y he aquí las diferencias
    : <br>
    <font size="2"></p>
    <pre>
FileSize:   2FA780h
DD     2F2726h
DB         C7h
DB         7Fh
DD     2F2727h
DB         A2h
DB         C1h
DD     2F272Dh
DB         9Dh
DB         3Dh
DD     2F272Eh
DB         54h
DB         79h
</font>
Cambian 4 posiciones de memoria de un ejecutable a otro.        
Así pues una de las rutinas de acceso a disco que hemos        
desabilitado introduce en el ejecutable final la fecha de creación.        
Para más inri, esta fecha está encriptada y la llave de la        desencriptación es BBYYMMAARRCCOOSS.

Estos programadores nuncan        aprenderán a ser humildes, los muy jodidos. 
Si cazamos las dll de        disco que hemos anulado 
(copiar y pegar como ya vimos) y        desensamblamos, observamos que 
se utiliza una bonita función:        
DosDateTimeToFileTime function converts MS-DOS date and time        
values to a 64-bit file time. 
<font
size="2"></pre>
    <pre>
BOOL DosDateTimeToFileTime(

    WORD  wFatDate,	// 16-bit MS-DOS date 
    WORD  wFatTime,	// 16-bit MS-DOS time 
    LPFILETIME  lpFileTime 	// address of buffer for 64-bit file time
   );
</font>
Ponemos un bpx DosDateTimeToFileTime y lanzamos el        contaplus. EUREKA, aparecemos en spptr.dll, un par de f12 más y volvemos a        al ejecutable original. No os aburriré indicando como localizar la rutina        de comprobación del flag (ya somos mayorcitos), doy directamente el        parche: 
<font
size="2"></pre>
    <pre>Cambiamos 

:10001545 8D542428                lea edx, dword ptr [esp+28]
:10001549 51                      push ecx                   ;BBYYMMAARRCCOOSS
:1000154A 52                      push edx

Por 

:10001545 8D542428                lea edx, dword ptr [esp+28]
:10001549 51                      push ecx                   ;BBYYMMAARRCCOOSS
:1000154A 51                      push ecx                   ;BBYYMMAARRCCOOSS
</font>
Buscamos en spptr.dll 8d 54 24 28 51 52 lo encontramos en        0x154A y lo cambiamos por 51 Listo y a disfrutar. 
Ya es hora de volver        con la gorda y el peluo para tomar una cerveza. </b></pre>
    </td>
  </tr>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00"><font color="#00ff00">JUGUETEANDO</font>
    </font></b><p><b>*Existe una forma alternativa de corregir el problema de aplicación mal
    instalada. Si cogemos un dbf cualquiera del directorio /emp y lo copiamos con el nombre
    menumode.dbf , entramos en la aplicación pero en versión demostrativa, sin copias de
    seguridad y sin algunas opciones más. <br>
    <br>
    * Para convertir las copias de seguridad a la versión profesional, cambiad el nombre del
    fichero /emp/versione.dbf por /emp/versionp.dbf y /emp/menuwine.dbf /emp/menuwin.dbf .<br>
    Esto provoca un pequeño error al mirar el &quot;Acerca de&quot; en el CONTAPLUS, pero no
    tiene mayor importancia. Sospecho que con una poyada de estas más podemos pasar del
    CONTAPLUS élite al profesional, pero no he dado con la tecla. <br>
    <br>
    * Podemos copiar impunemente el directorio del CUENTAPLUS de un disco duro a otro sin
    necesidad de reinstalar. <br>
    <br>
    * Este mismo proceso es aplicable al NOMINAPLUS y FACTURAPLUS y el resto del paquete y muy
    probablemente al resto de productos de la empresa SP. El TVPPLUS está cascado (por lo
    menos en el cd) por lo que no se ha podido probar y el PersonalPlus no necesita retoques.
    PAra el resto de componenetes del paquete, simplemente se parchea el instalar.exe, y se
    copia el c.a del CONTAPLUS y se comienza la instalación. Una vez instalado, se copia el
    spptr.dll del contaplus en el directorio apropiado para cada producto (NOMINAPLUS: /exe)
    (FACTURAPLUS: /exe) <br>
    <br>
    * Para pasar una version demostrativa (o educativa) a versión élite, basta con aplicar
    el parche al spprt.dll y borrar el fichro /emp/menumode.dbf </b></td>
  </tr>
</TBODY>
</table>
</center></div>

<p align="center"><br>
<br>
</p>
<div align="center"><center>

<table bgColor="#000000" border="4" width="80%">
<TBODY>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00"><font color="#00ff00">PD PARA EL
    PROGRAMADOR</font> </font></b><p><b>Querido Marco:<br>
    <br>
    Has construido una buena protección. <br>
    He estado tentado de guardarme el crack por respeto. <br>
    Pero lo que me decidió fue la decepción de ver como usabas Clipper y tu forma relajada
    de acceder al disco mediante deviceiocontrol. <br>
    La próxima vez esmérate un poco más, aunque he de reconocer que he disfrutado con tu
    protección en grande. </b></td>
  </tr>
  <tr>
    <td align="left" vAlign="top"><b><font color="#00ff00"><font color="#00ff00">Notas para
    los lectores.</font> </font></b><p><b>1.- Los mensajes del tipo &quot;Hazme el crack para
    ....&quot;, &quot;Dime como se crackea....&quot;, &quot;Dime donde puedo
    encontrar...&quot; son automáticamente ignorados. El objetivo de estos artículos es
    enseñar a crackear no enseñar a ser unos llorones ineptos que sólo saben mendigar.<br>
    <br>
    2.- Sólo responderé a preguntas teóricas sobre cracks, indicando algunas pistas que
    faciliten la labor.<br>
    <br>
    3.- Narices, escribid artículos sobre los programas que crackeeis.<br>
    De nada sirve lo que aprendéis si no lo repartís, se os pudre en el cabeza, palabra.<br>
    <br>
    4.- Lamento no haber contestado a ciertos mails interesantes. Desde aquí mis excusas.<br>
    <br>
    5.- Si os ha servido para algo mis artículos, no seáis vagos y mandad un mail
    indicándomelo. </b><br>
    <br>
    <font color="#ffcc33">Estado+Porcino</font> <br>
    <br>
    <b>Esperamos vuestras opiniones, sugerencias y ensayos en <a
    href="mailto:estadoporcino@hotmail.com">estadoporcino@hotmail.com</a></b> <br>
    </p>
    <p><b>Recordad bebed de la fuente, buscad a <font color="#00ff00">+ORC</font> en la red.</b>
    </td>
  </tr>
</TBODY>
</table>
</center></div>

<p align="center"><br>
<br>
</p>
<div align="center"><center>

<table border="0">
<TBODY>
  <tr>
    <td align="middle" vAlign="center"><p align="center">&nbsp;</td>
  </tr>
</TBODY>
</table>
</center></div>


</body>
</html>
